---
title: "Bellabeat"
output:
  pdf_document: default
  html_document: default
date: '2022-04-04'
editor_options:
  markdown:
    wrap: 72
---

## Casestudy in R for Bellabeat

by Irina Khafizova

### Table of Contents

Table of Contents

1.  Introduction

2.  The Task

3.  Prepare Phase

4.  Process Phase

4.1 Uploading the data frames 

4.2. Data frames review and data cleaning 

4.3. Merging data frames

5.  Analyze and Share Phases 

5.1. Summarizing values 

5.2. Activity levels

5.3. Sleep levels 

5.4. Use of the Bellabeat device 

5.5. Correlations

6.  Solution

### 1. Introduction

Bellabeat is a high-tech company that manufactures health-focused smart
devices for women, founded in 2013 by Urška Sršen and Sando Mur. Their
products collect data on nutrition, activity, sleep and stress
empowering women with knowledge which help them better understand their
habits and make healthier decisions.

Here is a list of their current products:

Bellabeat app: provides users with health data related to their
activity, sleep, stress, menstrual cycle and mindfulness habits.

Leaf: a wellness tracker that can be worn as a bracelet,necklace or
clip, connected to the Bellabeat app to track activity, sleep and
stress.

Time: a wellness watcg that tracks activity,sleep and stress, connected
to the Bellabeat app to get insights into the user's wellness.

Spring: a water bottle that tracks daily water intake, connected to the
Bellabeat app to track hydration levels.

Bellabeat membership: a subscription-bases membership program for users,
with 24/7 access to fully personalized guidance on nutrition, activity,
sleep, health, beauty and mindfulness based on lifestyle and goals.

### 2. The Task

#### Business task

This case study focuses on analyzing smart device usage data to gain
insight into how consumers are using the Bellabeat device, which will
help unlock new growth opportunities.

#### Stakeholders

Urška Sršen - Bellabeat's co-founder and Chief Creative Officer Sando
Mur - Bellabeat's co-founder and key member of Bellabeat executive team

### 3. Prepare

#### Datasets

The data source used for this analysis is [FitBit Fitness Tracker
Data](https://www.kaggle.com/datasets/arashnic/fitbit), which is a
public dataset made available through
[Mobius](https://www.kaggle.com/arashnic).

#### Data privacy and accessibility

When verifying the
[Metadata](https://www.kaggle.com/datasets/arashnic/fitbit/metadata) we
can confirm that the dataset is an [open
source](https://zenodo.org/record/53894#.YkIkKS-B1N2). The dataset has
been generated by respondents to a distributed survey via Amazon
Mechanical Turk between 03.12.2016 and 05.12.2016. Thirty eligible
Fitbit users consented to the submission of personal tracker data,
including minute-level output for physical activity, heart rate, and
sleep monitoring

#### Data organization

The data comes in 18 .csv files with several rows for each subject (ID).
Part of the files have a long format, and others have a wide format.

#### Data limitations

The data is original, comprehensive and cited. However, it includes a
small sample, a small period of data collection (31 days) and it doesn't
show any demographic information, which translates in highly possibly
biased data. Another limitation is that the data is not current (2016).

### 4. Process Phase

#### 4.1 Uploading the data frames 

```{r include=FALSE}
library(readr)
library(readxl)
library(tidyr)
library(tidyverse)
library(janitor)
library(colorspace)
library(formattable)
library(dplyr)
library(ggplot2)
library(here)
library(lubridate)
```


For this project, we will be focusing on files with daily data.

```{r echo=TRUE}
daily_activity <- read_csv("/Users/irina/Desktop/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
daily_intensities <- read_csv("/Users/irina/Desktop/Fitabase Data 4.12.16-5.12.16/dailyIntensities_merged.csv")
daily_calories <- read_csv("/Users/irina/Desktop/Fitabase Data 4.12.16-5.12.16/dailyCalories_merged.csv")
daily_steps <- read_csv("/Users/irina/Desktop/Fitabase Data 4.12.16-5.12.16/dailySteps_merged.csv")
daily_sleep <- read_csv("/Users/irina/Desktop/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
```

#### 4.2. Data frames review and data cleaning

Let's take a look at the information contained by each data frame

```{r echo=TRUE}
colnames(daily_activity)
```
```{r echo=TRUE}
colnames(daily_calories)
```

```{r echo=TRUE}
colnames(daily_intensities)
```

```{r echo=TRUE}
colnames(daily_steps)
```

```{r echo=TRUE}
colnames(daily_sleep)
```

The data set "daily_activities" contains the information from daily_steps, daily_intensities, daily_calories data sets, therefore, we can safely remove them and proceed.

```{r echo=TRUE}
rm(daily_steps, daily_calories, daily_intensities)
```

##### Then, let's check out the user participation.

```{r echo=TRUE}
id_summary1 <- data.frame(ids_daily_activity = n_distinct(daily_activity$Id), ids_daily_sleep = n_distinct(daily_sleep$Id))
ids_summary2 <- gather(id_summary1, dataframe, IDs, factor_key=TRUE) %>%
  arrange(desc(IDs))
print(ids_summary2)
```
##### Structure of the data frames:
Let's take a look at how the data is organized 

```{r echo=TRUE}
glimpse(daily_activity)
glimpse(daily_sleep)
```

We notice that the column names aren't clear enough

```{r echo=TRUE}
daily_activity <- clean_names(daily_activity)
daily_sleep <- clean_names(daily_sleep)
```

Moreover, it appears the dates are not in the right format 

```{r echo=TRUE}
daily_sleep <- daily_sleep %>%
  mutate(sleep_day = as_date(sleep_day, format = "%m/%d/%Y"))
daily_activity <- daily_activity %>% 
  mutate(activity_date = as_date(activity_date, format = "%m/%d/%Y"))
```

Now, let's run the glimpse function again to ensure the dates are in proper format

```{r echo=TRUE}
glimpse(daily_activity)
glimpse(daily_sleep)
```

##### Checking for duplicates:

```{r echo=TRUE}
sum(duplicated(daily_activity))
sum(duplicated(daily_sleep))
```

There are 3 duplicates in the daily_sleep data frame. Let's remove them

```{r echo=TRUE}
daily_sleep <- daily_sleep %>% 
  distinct()
```

Let's check for duplicates again 

```{r echo=TRUE}
sum(duplicated(daily_sleep))
```

Next step is removing empty fields

```{r echo=TRUE}
daily_activity <- daily_activity %>% 
  drop_na()
daily_sleep <- daily_sleep %>% 
  drop_na()
```

##### Merging data frames

In order to merge the data frames, we will use their common values: id and date. 

First, we will need to rename the date columns
```{r echo=TRUE}
daily_activity <- daily_activity %>% 
  rename(date = activity_date)
daily_sleep <- daily_sleep %>% 
  rename(date = sleep_day)
```
Then, we can merge the data frames

```{r echo=TRUE}
daily_activity_sleep <- merge(daily_activity, daily_sleep, by=c("id","date"))
glimpse(daily_activity_sleep)
```

### 5. Analyze and Share

#### 5.1 Summarizing values 

```{r echo=TRUE}
daily_average <- daily_activity_sleep %>% 
  group_by(id) %>% 
  summarise(avg_steps = mean(total_steps), avg_cals = mean(calories),
            avg_sleep = mean(total_minutes_asleep),
            avg_in_bed = mean(total_time_in_bed))
glimpse(daily_average)
```

#### 5.3 Activity Level

We will be classifying the levels according to this article, ["How Many Steps a Day is Considered Active](https://www.medicinenet.com/how_many_steps_a_day_is_considered_active/article.htm)

```{r echo=FALSE}
classification_levels <- tibble( 
  steps_day = c('<5000', '5000 - 7499', '7500 - 9999', '>10000'),
  level = c('Sedentary', 'Low active', 'Somewhat active', 'Active'))

classification_levels
```

Let's assign this classification to our data

```{r echo=TRUE}
average_levels <- daily_average %>% 
  mutate(level = case_when(
  avg_steps < 5000 ~ 'Sedentary',
  avg_steps >= 5000 & avg_steps <= 7499 ~ 'Low Active',
  avg_steps >= 7500 & avg_steps <= 9999 ~ 'Somewhat Active',
  avg_steps >= 10000 ~ 'Active'
  ))

average_levels
```
We need to get percentage of each activity level

```{r echo=TRUE}
activity_levels_percentage <- average_levels %>%
  group_by(level) %>%
  summarise(total_level=n()) %>%
  mutate(percentage = (total_level / sum(total_level))) %>%
  mutate(percentage = formattable::percent(percentage)) %>%
  arrange((level))
```
```{r echo=TRUE}
ggplot(activity_levels_percentage, aes(x="", y=percentage, fill=level))+
  geom_bar(width=1, stat="identity", color="white")+
  coord_polar("y", start = 0)+
  geom_text(aes(label=percentage), position = position_stack(vjust = 0.5), size = 5)+
  labs(title = "Activity Level Distribution")+
  scale_fill_brewer(palette ="BuPu")+
  guides(fill = guide_legend(title=NULL))+
  theme_void()+
  theme(plot.title = element_text(size=20), legend.text = element_text(size=15))

```
 
##### Insights 
Looking at our diagram, 37.50% are somewhat active, with an average of 7500 and 9999 steps, meanwhile Low Active, Sedentary, and Active users share equal parts of 20.83%. 

#### 5.3 Sleep levels

It is recommended that adults gets between 7 to 9 hours of sleep each night. Therefore, we will establish the following rules

- Less, than the recommended, 7 hrs
- The recommended, 7-9 hrs
- More, than the recommended, 9+ hrs

```{r echo=TRUE}
average_levels <- daily_average %>% 
  mutate(avg_sleep = case_when(
    avg_sleep < 420 ~ 'Less than the recommended, 7 hrs',
    avg_sleep >= 420 & avg_sleep < 540 ~ 'The recommended, 7-9 hrs',
    avg_sleep >= 540 ~ 'More than the recommended, 9+ hrs'
  )) 
```
Now, let's assign percentage by level of sleep

```{r echo=TRUE}
sleep_average_levels <- average_levels %>%
  group_by(avg_sleep) %>%
  summarise(n_users=n()) %>%
  mutate(users_percentage = (n_users / sum(n_users))) %>%
  mutate(users_percentage = formattable::percent(users_percentage, 0)) %>%
  arrange(users_percentage)
```

```{r echo=TRUE}
ggplot(sleep_average_levels, aes(x="", y=users_percentage, fill=avg_sleep))+
  geom_bar(width=1, stat="identity", color="white")+
  coord_polar("y", start = 0)+
  geom_text(aes(label=users_percentage), position = position_stack(vjust = 0.5), size = 5)+
  labs(title = "Sleep Distribution")+
  scale_fill_brewer(palette ="BuPu")+
  guides(fill = guide_legend(title=NULL))+
  theme_void()+
  theme(plot.title = element_text(size=20), legend.text = element_text(size=15))

```


##### Insight 

We see that more than 50% of our users sleep less than the recommended amount of hours, while around 4% sleep more than the recommended, leaving 42% with the recommended amount of sleep.

#### 5.4 Use of Bellabeat Devices

We want to see how frequent each participant uses the devices. We will categorize them by the following

- 1 to 10 days: low usage
- 10 to 20 days: medium usage
- 20+ days: high usage

```{r echo=TRUE}
devices_usage <- daily_activity_sleep %>%
  group_by(id) %>%
  summarize(date=sum(n())) %>%
  rename(days_used = date) %>%
  mutate(usage = case_when(
    days_used >= 1 & days_used <= 10 ~ 'low usage',
    days_used >= 11 & days_used <= 20 ~ 'medium usage',
    days_used > 20 ~ 'high usage'
  )) %>%
  group_by(usage) %>%
  summarise(id=n()) %>%
  mutate(usage_percentage = (id / sum(id))) %>%
  mutate(usage_percentage = formattable::percent(usage_percentage)) %>%
  arrange(usage_percentage)
```

```{r echo=TRUE}
ggplot(data=devices_usage)+
  geom_col(mapping = aes(x=usage, y=(usage_percentage*100), fill=(usage_percentage*100)))+
  ylab("%") +
  xlab("")+
  scale_fill_gradient(low = "purple", high = "purple4")+
  theme(plot.title = element_text(hjust = 0.5,vjust= 1, size = 22, face = "bold"), 
        axis.text.x = element_text(angle = 0, size=11, vjust= 0.4),
        axis.text.y = element_text(size=11),
        legend.title = element_blank(),
        legend.position = "none")+
  labs(title = "Use of Bellabeat device")
```

##### Insight 

Half of the users on average use the Bellabeat device more than 20 days, while 37.50% are within the low usage category 

#### 5.5 Correlation

We will only be focusing on device usage vs steps correlation.

```{r echo=TRUE}
device_usage_day <- daily_activity_sleep %>%
  group_by(id) %>%
  summarize(date=sum(n())) %>%
  rename(days_used = date) %>%
  mutate(usage = case_when(
    days_used >= 1 & days_used <= 10 ~ 'low usage',
    days_used >= 11 & days_used <= 20 ~ 'medium usage',
    days_used > 20 ~ 'high usage'
  ))

```

Merging usage and steps data frames

```{r echo=TRUE}
usage_vs_steps <- merge(daily_activity, device_usage_day, by=c("id"))

glimpse(usage_vs_steps)


high_usage <- subset(usage_vs_steps, usage == "high usage")
mild_usage <- subset(usage_vs_steps, usage == "mild usage")
low_usage <- subset(usage_vs_steps, usage == "low usage")

```
Graphing
```{r echo=TRUE}
ggplot(usage_vs_steps, aes(x=date, y=total_steps, fill=usage)) +
  geom_point(aes(shape=usage, color=usage))+
  scale_shape_manual(values=c(6, 16, 17))+
  scale_color_manual(values=c('green4','red', 'purple4'))+
  scale_size_manual(values=c(2,3,4))+
  theme(legend.position="right", plot.title = element_text(size=22), legend.text = element_text(size=15))+
  geom_smooth(method="lm", se=FALSE, aes(color=factor(usage)))+
  labs(title = "Device usage vs Steps", x = "Date", y = "Steps")
```

##### Insght 

We notice that the users with high usage of devices attain consistent amount of steps that is very close to the recommended. However, users with medium and low usages have a decreasing amount of total steps through the time period. 

### 6. Solutions 

With the completed analysis we have reached the following conclusions: a big chunk of the users(37.50%) are only somewhat active, with an average between 7500 and 9999 steps a day. Around 50% of the users get less than the recommended amount of sleep of 7 to 9 hours. Around half of the users attained high usage of the devices within the mentioned time period. However, most of the other have attain low device usage of 10 days or less. Finally, looking at the correlation between steps and device usage, it is clear that participants with high usage also maintained a consistent amount of steps very close to the recommended. 

Based on these finding, users have the following areas for improvement: 

- exceed 10,000 steps a day

- sleep at least 7 hours a night

- increase device usage throughout a month

My recommendations:
Exceeding 10,000 steps a day

- Daily reminders to take longer routes while doing daily routines such as travelling to work by foot, taking the stairs, getting of public transportation a stop or two early and walk the rest. 

- Guides of simple workouts at home

- Presents in the form of promo-codes, when achieving a desired amount of steps in a month

- Health articles on the importance on achieving a minimum of 10,000 steps a day
  
Sleeping at least 7 hours a night
- Setting up bedtime within the app and sending reminders a certain amount of time prior to bedtime to reduce light and workload

- Tips on how to improve pre-bed time routine (ex. disconnecting from electronic devices)

- Encourage relaxing activities such as reading

- Monitoring caffeine intake hours before bedtime

- Reducing stress levels by practicing meditation
  
Increasing device usage: 
- Creating more stylish options for different occasions

- Ability to connect different apps within a phone to the Bellabeat app (ex. Health app)

For further analysis, I would recommend Bellabeat to store more data regarding their users such  as demographics, age, occupation, lifestyle. One of the ways of obtaining such data is periodic surveys within the app







